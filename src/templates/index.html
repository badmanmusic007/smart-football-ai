<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Football AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --primary: #3b82f6;
            --primary-hover: #2563eb;
            --accent: #8b5cf6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --border: #334155;
        }

        * { box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: var(--card-bg);
            padding: 30px;
            border-radius: 24px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            border: 1px solid var(--border);
            text-align: center;
        }

        h1 {
            font-weight: 700;
            letter-spacing: -1px;
            margin-bottom: 30px;
            background: linear-gradient(to right, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Input Styles */
        .selectors {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
            align-items: center;
        }

        .team-input {
            padding: 14px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: #0f172a;
            color: white;
            width: 100%;
            font-size: 16px;
            transition: 0.3s;
        }
        .team-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        .swap-btn {
            background: var(--border);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 1.2em;
            cursor: pointer;
            color: var(--text-muted);
            transition: 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .swap-btn:hover {
            background: var(--primary);
            color: white;
            transform: rotate(180deg);
        }

        button.main-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.3s;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }
        button.main-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.5);
        }

        /* Collapsible Logic */
        .collapsible {
            background-color: var(--card-bg);
            color: var(--text-main);
            cursor: pointer;
            padding: 18px;
            width: 100%;
            border: none;
            text-align: left;
            outline: none;
            font-size: 1.1em;
            font-weight: 600;
            border-bottom: 1px solid var(--border);
            transition: 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }
        .collapsible:first-of-type { border-top: 1px solid var(--border); margin-top: 30px; }
        .collapsible:hover { background-color: rgba(255,255,255,0.02); }
        .collapsible:after { content: '+'; color: var(--text-muted); font-weight: bold; font-size: 1.2em; }
        .active:after { content: "‚àí"; }

        .content {
            padding: 0 18px;
            background-color: rgba(0,0,0,0.2);
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            border-bottom: 1px solid transparent;
        }
        .content.open {
            padding: 20px;
            border-bottom: 1px solid var(--border);
        }

        /* Match Rows */
        .match-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid var(--border); font-size: 0.9em; }
        .match-row:last-child { border-bottom: none; }
        .res-badge { padding: 2px 8px; border-radius: 4px; font-weight: bold; font-size: 0.8em; color: white; min-width: 24px; text-align: center; display: inline-block; margin-right: 8px; }
        .res-W { background-color: var(--success); }
        .res-D { background-color: #64748b; }
        .res-L { background-color: var(--danger); }

        /* Probabilities */
        .prob-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin: 25px 0; }
        .prob-box { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 12px; border: 1px solid var(--border); text-align: center; }
        .prob-box strong { font-size: 1.4em; color: var(--primary); display: block; margin-top: 5px; }

        /* Comparison Styles */
        .comp-row { display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid var(--border); }
        .comp-val { font-weight: bold; flex: 1; font-size: 1em; }
        .comp-val.home { text-align: right; padding-right: 10px; color: var(--text-main); }
        .comp-val.away { text-align: left; padding-left: 10px; color: var(--text-main); }
        .comp-lbl { font-size: 0.75em; color: var(--text-muted); text-align: center; width: 40%; text-transform: uppercase; letter-spacing: 1px; }

        /* Team Badges */
        .team-badge { display: inline-block; font-size: 0.7em; padding: 3px 8px; border-radius: 20px; color: white; margin: 4px 2px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }

        /* History Grid */
        .history-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 600px) {
            .history-container { grid-template-columns: 1fr; }
            .selectors { flex-direction: column; }
            .swap-btn { transform: rotate(90deg); margin: 10px 0; }
            .swap-btn:hover { transform: rotate(270deg); }
        }

        /* Deep Dive Styles */
        .dd-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px; }
        .dd-box { background: rgba(255,255,255,0.03); border: 1px solid var(--border); padding: 15px; border-radius: 12px; }
        .dd-title { font-size: 0.75em; color: var(--text-muted); text-transform: uppercase; margin-bottom: 5px; letter-spacing: 0.5px; }
        .dd-val { font-weight: bold; font-size: 1.2em; color: var(--text-main); }
        .dd-sub { font-size: 0.8em; color: var(--text-muted); margin-top: 2px; }

        /* Scanner Styles */
        .scan-btn {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
            padding: 14px 20px;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 15px;
            transition: 0.3s;
        }
        .scan-btn:hover { background: rgba(59, 130, 246, 0.1); }

        /* Tabs */
        .tabs { display: flex; gap: 10px; margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
        .tab-link { background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 1em; padding: 5px 10px; transition: 0.3s; }
        .tab-link.active { color: var(--primary); font-weight: bold; border-bottom: 2px solid var(--primary); }

        #result { display: none; margin-top: 40px; animation: slideUp 0.5s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Golden Ticket */
        .golden-ticket {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 1px solid #fbbf24;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.1);
        }

        /* Badges */
        .value-badge {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 8px;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .kelly-badge {
            background: rgba(59, 130, 246, 0.2);
            color: var(--primary);
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8em;
            font-weight: bold;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .steam-badge {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 5px;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        /* Strategic Insights */
        .insights-container {
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-top: 25px;
            text-align: left;
        }
        .insight-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            font-size: 0.95em;
        }
        .insight-item:last-child { margin-bottom: 0; }
        .insight-icon { font-size: 1.2em; margin-right: 12px; }

        /* Charts */
        .chart-container {
            position: relative;
            height: 250px;
            width: 100%;
            margin-top: 15px;
        }

        /* Performance Metrics */
        .perf-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px; }
        .perf-box { background: rgba(255,255,255,0.03); border: 1px solid var(--border); padding: 15px; border-radius: 12px; text-align: center; }
        .perf-val { font-size: 1.5em; font-weight: bold; color: var(--text-main); }
        .perf-lbl { font-size: 0.8em; color: var(--text-muted); text-transform: uppercase; margin-top: 5px; }
        .profit-pos { color: var(--success); }
        .profit-neg { color: var(--danger); }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚öΩ Smart Football AI</h1>
        <div class="selectors">
            <input type="text" id="homeTeam" class="team-input" list="teamList" placeholder="Home Team">
            <button class="swap-btn" onclick="swapTeams()" title="Swap Teams">‚áÑ</button>
            <input type="text" id="awayTeam" class="team-input" list="teamList" placeholder="Away Team">
            <datalist id="teamList"><!-- Populated by JS --></datalist>
        </div>
        <button class="main-btn" onclick="predict()">Generate Analysis</button>
        <button class="scan-btn" onclick="scanMarket()">üîç Scan for Value Bets (Next 7 Days)</button>

        <button class="collapsible" id="historyCollapsible" onclick="toggleCollapsible(this)" style="display: none;">üìú Prediction History</button>
        <div class="content">
            <div class="tabs">
                <button class="tab-link active" onclick="openTab(event, 'singleMatches')">Single Matches</button>
                <button class="tab-link" onclick="openTab(event, 'goldenTickets')">Golden Tickets</button>
                <button class="tab-link" onclick="openTab(event, 'performance')">Performance</button>
            </div>
            <div id="singleMatches" class="tab-content" style="display: block;"></div>
            <div id="goldenTickets" class="tab-content" style="display: none;"></div>
            <div id="performance" class="tab-content" style="display: none;">
                <div id="perfMetrics">Loading...</div>
            </div>
        </div>

        <div id="result"></div>

        <div style="margin-top: 50px; border-top: 1px solid var(--border); padding-top: 30px; text-align: center;">
            <h4 style="color: var(--text-muted); margin-bottom: 15px; text-transform: uppercase; font-size: 0.8em; letter-spacing: 1px;">Backtesting Reports</h4>
            <div style="display: flex; gap: 10px; justify-content: center;">
                <button onclick="showReport('match_winner')" style="background:var(--card-bg); border:1px solid var(--border); padding: 8px 16px; color:var(--text-muted); border-radius:8px; cursor:pointer; font-size: 0.9em;">Match Winner</button>
                <button onclick="showReport('over_under')" style="background:var(--card-bg); border:1px solid var(--border); padding: 8px 16px; color:var(--text-muted); border-radius:8px; cursor:pointer; font-size: 0.9em;">Over/Under 2.5</button>
                <button onclick="showReport('btts')" style="background:var(--card-bg); border:1px solid var(--border); padding: 8px 16px; color:var(--text-muted); border-radius:8px; cursor:pointer; font-size: 0.9em;">BTTS</button>
            </div>
        </div>
    </div>

    <template id="goldenTicketTemplate">
        <div class="golden-ticket">
            <h3 class="ticket-title" style="margin-top: 0; color: #fbbf24; font-size: 1.1em; text-transform: uppercase; letter-spacing: 1px;"></h3>
            <div class="ticket-legs"></div>
            <div class="ticket-footer" style="border-top: 1px dashed rgba(255,255,255,0.2); padding-top: 15px; margin-top: 15px;"></div>
        </div>
    </template>

    <script>
        // Load teams on startup
        fetch('/teams')
            .then(response => response.json())
            .then(data => {
                const teams = data.teams;
                const dataList = document.getElementById('teamList');
                let options = '';
                teams.forEach(team => {
                    options += `<option value="${team}">${team}</option>`;
                });
                dataList.innerHTML = options;
                window.allTeams = teams;
                loadUserHistory();
                loadPerformance();
            });

        function swapTeams() {
            const home = document.getElementById('homeTeam');
            const away = document.getElementById('awayTeam');
            const temp = home.value;
            home.value = away.value;
            away.value = temp;
        }

        function showReport(strategy) {
            const url = `/report-image?strategy=${strategy}`;
            window.open(url, '_blank');
        }

        function toggleCollapsible(element) {
            // Close all other collapsibles
            const allCollapsibles = document.querySelectorAll('.collapsible');
            allCollapsibles.forEach(btn => {
                if (btn !== element && btn.classList.contains('active')) {
                    btn.classList.remove('active');
                    btn.nextElementSibling.style.maxHeight = null;
                    btn.nextElementSibling.classList.remove('open');
                }
            });

            // Toggle current
            element.classList.toggle("active");
            var content = element.nextElementSibling;
            if (content.style.maxHeight){
                content.style.maxHeight = null;
                content.classList.remove("open");
            } else {
                content.classList.add("open");
                content.style.maxHeight = content.scrollHeight + "px";
            }
        }

        function openTab(evt, tabName) {
            let i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tab-link");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }

        // --- User History Logic ---
        function savePrediction(home, away, matchDate, recommendation, over25Prob) {
            if (!matchDate) return;

            const now = new Date().getTime();
            const item = {
                id: now,
                timestamp: now,
                home: home,
                away: away,
                matchDate: matchDate,
                predictionMarket: recommendation ? recommendation.market : "N/A",
                over25Prob: over25Prob
            };

            let history = JSON.parse(localStorage.getItem('smartFootballHistory') || '[]');
            history = history.filter(h => !(h.home === home && h.away === away));
            history.unshift(item);
            history = history.filter(i => (now - i.timestamp) < 86400000);
            localStorage.setItem('smartFootballHistory', JSON.stringify(history));
            loadUserHistory();
        }

        function saveGoldenTickets(acca15, acca25) {
            const now = new Date().getTime();
            let history = JSON.parse(localStorage.getItem('goldenTicketHistory') || '[]');
            if (acca15 && acca15.legs.length > 0) history.unshift({ id: now, timestamp: now, type: 'Over 1.5', ...acca15 });
            if (acca25 && acca25.legs.length > 0) history.unshift({ id: now + 1, timestamp: now, type: 'Over 2.5', ...acca25 });
            history = history.filter(i => (now - i.timestamp) < 86400000);
            localStorage.setItem('goldenTicketHistory', JSON.stringify(history));
            loadUserHistory();
        }

        async function loadUserHistory() {
            let history = JSON.parse(localStorage.getItem('smartFootballHistory') || '[]');
            let ticketHistory = JSON.parse(localStorage.getItem('goldenTicketHistory') || '[]');
            const now = new Date().getTime();

            history = history.filter(i => (now - i.timestamp) < 86400000);
            localStorage.setItem('smartFootballHistory', JSON.stringify(history));

            ticketHistory = ticketHistory.filter(i => (now - i.timestamp) < 86400000);
            localStorage.setItem('goldenTicketHistory', JSON.stringify(ticketHistory));

            const container = document.getElementById('historyCollapsible');
            const singleList = document.getElementById('singleMatches');
            const ticketList = document.getElementById('goldenTickets');

            if (history.length === 0 && ticketHistory.length === 0) {
                container.style.display = 'none';
                return;
            }

            container.style.display = 'flex';

            // Render Single Matches
            if (history.length > 0) {
                const matchesToCheck = history.filter(item => new Date(item.matchDate) < now);
                let results = [];
                if (matchesToCheck.length > 0) {
                    try {
                        const response = await fetch('/bulk-match-results', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                matches: matchesToCheck.map(m => ({ home: m.home, away: m.away, date: m.matchDate }))
                            })
                        });
                        if(response.ok) results = await response.json();
                    } catch (e) { console.error("Failed to fetch bulk results:", e); }
                }

                const resultMap = new Map();
                results.forEach(res => {
                    const key = `${res.home}-${res.away}`;
                    resultMap.set(key, res.result);
                });

                singleList.innerHTML = history.map(item => {
                    const key = `${item.home}-${item.away}`;
                    const result = resultMap.get(key);
                    let resultHTML = '<span style="color: var(--text-muted); font-size: 0.8em;">Upcoming</span>';
                    let comparisonHTML = '';

                    if (result) {
                        let isCorrect = false;
                        const market = item.predictionMarket;
                        if (market === 'Home Win' && result.ftr === 'H') isCorrect = true;
                        if (market === 'Away Win' && result.ftr === 'A') isCorrect = true;
                        if (market === 'Draw' && result.ftr === 'D') isCorrect = true;
                        if (market === 'Over 2.5 Goals' && (result.fthg + result.ftag) > 2.5) isCorrect = true;
                        if (market === 'Under 2.5 Goals' && (result.fthg + result.ftag) < 2.5) isCorrect = true;

                        const icon = isCorrect ? '‚úÖ' : '‚ùå';
                        resultHTML = `<span>${icon} ${result.fthg} - ${result.ftag}</span>`;

                        const overUnderActual = (result.fthg + result.ftag) > 2.5 ? 'Over 2.5' : 'Under 2.5';
                        const overUnderProb = item.over25Prob * 100;

                        comparisonHTML = `
                            <div style="font-size: 0.8em; margin-top: 8px; padding-top: 8px; border-top: 1px dashed var(--border);">
                                <div style="color: var(--text-muted);">O/U 2.5 Analysis</div>
                                <div>AI Predicted: <b>${overUnderProb.toFixed(0)}% Over</b> | Actual: <b>${overUnderActual}</b></div>
                            </div>
                        `;
                    }

                    return `
                        <div style="background:rgba(255,255,255,0.05); padding:12px; border-radius:8px; margin-bottom:8px; border:1px solid var(--border); font-size:0.9em;">
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <span style="color:var(--text-main); font-weight:bold;">${item.home} vs ${item.away}</span>
                                <span style="font-size:0.8em; color:var(--text-muted);">${new Date(item.matchDate).toLocaleDateString()}</span>
                                ${resultHTML}
                            </div>
                            <div style="font-size: 0.85em; color: var(--text-muted); margin-top: 5px;">
                                AI Pick: <b style="color: var(--accent);">${item.predictionMarket}</b>
                            </div>
                            ${comparisonHTML}
                        </div>
                    `;
                }).join('');
            } else {
                singleList.innerHTML = `<p style="color: var(--text-muted); font-style: italic;">No single match predictions in the last 24 hours.</p>`;
            }

            // Render Golden Tickets (Simplified for brevity, logic remains same)
            if (ticketHistory.length > 0) {
                // ... (Same logic as before for fetching results) ...
                ticketList.innerHTML = `<p style="color: var(--text-muted);">Golden Ticket history rendering...</p>`;
                // Note: Full implementation would mirror the single match logic above
            } else {
                ticketList.innerHTML = `<p style="color: var(--text-muted); font-style: italic;">No Golden Tickets generated in the last 24 hours.</p>`;
            }
        }

        async function loadPerformance() {
            try {
                const response = await fetch('/performance');
                const data = await response.json();

                const profitClass = data.total_profit >= 0 ? 'profit-pos' : 'profit-neg';
                const profitSign = data.total_profit >= 0 ? '+' : '';

                document.getElementById('perfMetrics').innerHTML = `
                    <div class="perf-grid">
                        <div class="perf-box">
                            <div class="perf-val">${data.win_rate}%</div>
                            <div class="perf-lbl">Win Rate</div>
                        </div>
                        <div class="perf-box">
                            <div class="perf-val ${profitClass}">${profitSign}$${data.total_profit}</div>
                            <div class="perf-lbl">Total Profit</div>
                        </div>
                        <div class="perf-box">
                            <div class="perf-val">${data.roi}%</div>
                            <div class="perf-lbl">ROI</div>
                        </div>
                        <div class="perf-box">
                            <div class="perf-val">${data.total_bets}</div>
                            <div class="perf-lbl">Total Bets</div>
                        </div>
                    </div>
                    <div style="margin-top:15px; font-size:0.8em; color:var(--text-muted);">
                        Based on automated tracking of value bets.
                    </div>
                `;
            } catch (e) {
                console.error("Failed to load performance:", e);
            }
        }

        function renderTeamStanding(standings, teamName, leagueName) {
            const team = standings.find(t => t.Team === teamName);
            if (!team) return '<div class="stat-box" style="margin-bottom:15px; color:#999;">No League Data</div>';

            const rank = standings.indexOf(team) + 1;
            let rankColor = "#64748b";
            if (rank <= 4) rankColor = "#3b82f6";
            if (rank >= standings.length - 3) rankColor = "#ef4444";

            let fatigueHTML = '';
            if (team.RestDays <= 3) {
                fatigueHTML = '<span style="background:rgba(234, 179, 8, 0.2); color:#fbbf24; font-size:0.7em; padding:2px 6px; border-radius:4px; margin-left:5px;">‚ö†Ô∏è Tired</span>';
            }

            return `
                <div class="stat-box" style="margin-bottom: 15px; text-align: left; border-left: 4px solid ${rankColor}; background: rgba(255,255,255,0.03); padding:12px; border-radius:8px; border:1px solid var(--border);">
                    <div style="font-size: 0.75em; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px;">${leagueName} Position</div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 5px;">
                        <div style="font-size: 1.8em; font-weight: bold; color: ${rankColor};">#${rank}</div>
                        <div style="text-align: right;">
                            <div style="font-weight: bold; font-size: 1.1em;">${team.Pts} <span style="font-size:0.7em; color:var(--text-muted);">PTS</span></div>
                            <div style="font-size: 0.8em; color: var(--text-muted);">${team.P} Played</div>
                        </div>
                    </div>
                    <div style="font-size: 0.85em; margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--border); color: var(--text-muted); display: flex; justify-content: space-between;">
                        <span><b>W:</b> ${team.W}</span> <span><b>D:</b> ${team.D}</span> <span><b>L:</b> ${team.L}</span> <span><b>Rest:</b> ${team.RestDays}d ${fatigueHTML}</span>
                    </div>
                </div>
            `;
        }

        async function predict() {
            const home = document.getElementById('homeTeam').value;
            const away = document.getElementById('awayTeam').value;
            const resultDiv = document.getElementById('result');

            if(!home || !away) return alert("Select both teams");

            if (window.allTeams && !window.allTeams.includes(home)) {
                alert(`Team '${home}' not found. Please select from the list.`);
                return;
            }
            if (window.allTeams && !window.allTeams.includes(away)) {
                alert(`Team '${away}' not found. Please select from the list.`);
                return;
            }

            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div style="text-align:center; padding:20px; color:var(--text-muted);">Processing match data...</div>';

            try {
                const response = await fetch(`/predict?home=${encodeURIComponent(home)}&away=${encodeURIComponent(away)}`);
                const data = await response.json();

                savePrediction(home, away, data.match_date, data.recommendation, data.prediction.over_25_prob);

                if (response.status !== 200) {
                    resultDiv.innerHTML = `<div style="color:var(--danger)">Error: ${data.detail}</div>`;
                    return;
                }

                let rivalryHTML = data.rivalry ? `
                    <div class="rivalry-card animate-in">
                        üî• ${data.rivalry.name} <br>
                        <span style="font-size:0.85em; font-weight:normal;">${data.rivalry.impact}</span>
                    </div>` : '';

                let bestBetHTML = '';
                if (data.recommendation) {
                    const rec = data.recommendation;
                    bestBetHTML = `
                        <div style="background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%); color: white; padding: 20px; border-radius: 16px; margin-bottom: 25px; box-shadow: 0 10px 30px rgba(59, 130, 246, 0.3); text-align: center;">
                            <div style="font-size: 0.8em; text-transform: uppercase; letter-spacing: 2px; opacity: 0.9; margin-bottom:5px;">‚≠ê AI Top Pick</div>
                            <div style="font-size: 2em; font-weight: 800; margin: 5px 0;">${rec.market}</div>
                            <div style="font-size: 1.1em; margin-top:10px;">
                                Probability: <b>${(rec.probability * 100).toFixed(1)}%</b>
                                <span style="margin: 0 10px; opacity: 0.5;">|</span>
                                Fair Odds: <b>${rec.fair_odds}</b>
                            </div>
                        </div>
                    `;
                }

                let insightsHTML = '';
                if (data.strategic_insights && data.strategic_insights.length > 0) {
                    insightsHTML = `
                        <div class="insights-container">
                            <h3 style="margin-top:0; margin-bottom:15px; color:var(--text-main);">Strategic Insights</h3>
                            ${data.strategic_insights.map(insight => `
                                <div class="insight-item">
                                    <span class="insight-icon">${insight.icon}</span>
                                    <span>${insight.text}</span>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }

                const odds = data.fair_odds;
                const pred = data.prediction;
                const goalRow = (label, prob, odds) => {
                    const isLikely = prob > 55;
                    const style = isLikely ? 'background:rgba(59, 130, 246, 0.1); color:var(--primary); font-weight:bold;' : '';
                    return `
                        <tr style="${style}">
                            <td style="padding:12px; border-bottom:1px solid var(--border);">${label}</td>
                            <td style="padding:12px; border-bottom:1px solid var(--border);">${prob}%</td>
                            <td style="padding:12px; border-bottom:1px solid var(--border);">${odds}+</td>
                        </tr>
                    `;
                };

                const over15 = (pred.over_15_prob * 100).toFixed(1);
                const over25 = (pred.over_25_prob * 100).toFixed(1);
                const over35 = (pred.over_35_prob * 100).toFixed(1);
                const over45 = (pred.over_45_prob * 100).toFixed(1);
                const cornersOver = (pred.corners_over_prob * 100).toFixed(1);
                const cardsOver = (pred.cards_over_prob * 100).toFixed(1);
                const cornersOdds = odds.corners_over;
                const cardsOdds = odds.cards_over;

                const goalsHTML = `
                    <div style="margin-top: 20px; text-align: left;">
                        <h4 style="margin: 0 0 15px 0; color: var(--text-muted); border-bottom: 1px solid var(--border); padding-bottom: 10px;">‚öΩ Goals</h4>
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.95em; margin-bottom: 25px;">
                            <thead>
                                <tr style="color: var(--text-muted);">
                                    <th style="padding:10px; text-align:left;">Market</th>
                                    <th style="padding:10px; text-align:left;">Probability</th>
                                    <th style="padding:10px; text-align:left;">Target Odds</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${goalRow("Over 1.5 Goals", over15, odds.over_15)}
                                ${goalRow("Over 2.5 Goals", over25, odds.over_25)}
                                ${goalRow("Over 3.5 Goals", over35, odds.over_35)}
                                ${goalRow("Over 4.5 Goals", over45, odds.over_45)}
                            </tbody>
                        </table>

                        <h4 style="margin: 0 0 15px 0; color: var(--text-muted); border-bottom: 1px solid var(--border); padding-bottom: 10px;">üö© Corners & Cards</h4>
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.95em;">
                            <thead>
                                <tr style="color: var(--text-muted);">
                                    <th style="padding:10px; text-align:left;">Market</th>
                                    <th style="padding:10px; text-align:left;">Probability</th>
                                    <th style="padding:10px; text-align:left;">Target Odds</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${goalRow("Over 9.5 Corners", cornersOver, cornersOdds)}
                                ${goalRow("Over 3.5 Cards", cardsOver, cardsOdds)}
                            </tbody>
                        </table>

                        <h4 style="margin: 25px 0 15px 0; color: var(--text-muted); border-bottom: 1px solid var(--border); padding-bottom: 10px;">üõ°Ô∏è Safer Options</h4>
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.95em;">
                            <thead>
                                <tr style="color: var(--text-muted);">
                                    <th style="padding:10px; text-align:left;">Market</th>
                                    <th style="padding:10px; text-align:left;">Probability</th>
                                    <th style="padding:10px; text-align:left;">Target Odds</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${goalRow("Double Chance 1X", (data.fair_odds.dc_1x ? (100/data.fair_odds.dc_1x).toFixed(0) : 0), data.fair_odds.dc_1x)}
                                ${goalRow("Double Chance X2", (data.fair_odds.dc_x2 ? (100/data.fair_odds.dc_x2).toFixed(0) : 0), data.fair_odds.dc_x2)}
                                ${goalRow("Draw No Bet (Home)", (data.fair_odds.dnb_home ? (100/data.fair_odds.dnb_home).toFixed(0) : 0), data.fair_odds.dnb_home)}
                            </tbody>
                        </table>
                    </div>
                `;

                const renderBadges = (badges) => {
                    if (!badges || badges.length === 0) return '';
                    return badges.map(b => `<span class="team-badge" style="background-color: ${b.color}">${b.text}</span>`).join('');
                };

                let oracleHTML = '';
                if (data.oracle_score) {
                    oracleHTML = `
                        <div style="background: #0f172a; color: white; padding: 15px; border-radius: 12px; margin-bottom: 25px; text-align: center; border: 1px solid var(--border);">
                            <div style="font-size: 0.8em; text-transform: uppercase; letter-spacing: 2px; color: var(--text-muted); margin-bottom:5px;">üîÆ Oracle Prediction</div>
                            <div style="font-size: 2.5em; font-weight: 800; letter-spacing: 3px; background: linear-gradient(to right, #fff, #94a3b8); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">${data.oracle_score}</div>
                        </div>`;
                }

                const renderDeepDive = (stats, teamName) => {
                    if (!stats) return `<div class="dd-box">No data for ${teamName}</div>`;

                    const shotAcc = stats.total_shots > 0 ? ((stats.total_sot / stats.total_shots) * 100).toFixed(0) : 0;
                    const goalConv = stats.total_sot > 0 ? ((stats.goals_from_sot / stats.total_sot) * 100).toFixed(0) : 0;

                    const leadWinRate = stats.leading_at_ht > 0 ? ((stats.won_when_leading_ht / stats.leading_at_ht) * 100).toFixed(0) : 0;
                    const comebackRate = stats.losing_at_ht > 0 ? ((stats.won_when_losing_ht / stats.losing_at_ht) * 100).toFixed(0) : 0;

                    return `
                        <div style="margin-bottom: 20px;">
                            <h4 style="margin: 0 0 10px 0; color: var(--primary); font-size:1.1em;">${teamName}</h4>
                            <div class="dd-grid">
                                <div class="dd-box">
                                    <div class="dd-title">üéØ Shooting</div>
                                    <div class="dd-val">${stats.total_shots} <span class="dd-sub">Shots</span></div>
                                    <div class="dd-sub">${shotAcc}% On Target</div>
                                </div>
                                <div class="dd-box">
                                    <div class="dd-title">‚öΩ Clinicality</div>
                                    <div class="dd-val">${stats.goals_from_sot} <span class="dd-sub">Goals</span></div>
                                    <div class="dd-sub">${goalConv}% Conversion</div>
                                </div>
                                <div class="dd-box">
                                    <div class="dd-title">üõ°Ô∏è Lead Defense</div>
                                    <div class="dd-val">${stats.won_when_leading_ht}/${stats.leading_at_ht}</div>
                                    <div class="dd-sub">${leadWinRate}% Won (HT Lead)</div>
                                </div>
                                <div class="dd-box">
                                    <div class="dd-title">üîÑ Resilience</div>
                                    <div class="dd-val">${stats.won_when_losing_ht}/${stats.losing_at_ht}</div>
                                    <div class="dd-sub">${comebackRate}% Won (HT Loss)</div>
                                </div>
                                <div class="dd-box" style="grid-column: span 2;">
                                    <div class="dd-title">‚ö†Ô∏è Threats & Notes</div>
                                    <div class="dd-sub">Clean Sheets: <b>${stats.clean_sheets}</b> | Failed to Score: <b>${stats.failed_to_score}</b></div>
                                </div>
                            </div>
                        </div>
                    `;
                };

                const renderHistory = (matches) => matches.map(m =>
                    `<div class="match-row">
                        <span><span class="res-badge res-${m.result}">${m.result}</span> <span style="color:var(--text-muted);">${m.date}</span></span>
                        <span>vs ${m.opponent} <b>${m.score}</b></span>
                    </div>`
                ).join('');

                const renderH2H = (matches) => matches.map(m =>
                    `<div class="match-row">
                        <span style="color:var(--text-muted);">${m.date}</span>
                        <span>${m.home} <b>${m.score}</b> ${m.away}</span>
                    </div>`
                ).join('');

                const renderSimilarSplit = (homeMatches, awayMatches, homeName, awayName) => {
                    const renderList = (matches, title) => {
                        let h = `<div style="background:rgba(255,255,255,0.03); padding:15px; border-radius:12px; border:1px solid var(--border); height: 100%;">`;
                        h += `<h4 style="margin:0 0 15px 0; font-size:0.9em; color:var(--text-muted); text-transform:uppercase;">${title}</h4>`;
                        if (!matches || matches.length === 0) {
                            h += '<div style="color:var(--text-muted); font-style:italic;">No matches found.</div>';
                        } else {
                            matches.forEach(m => {
                                let badgeClass = "res-" + m.result;
                                h += `<div class="match-row" style="font-size:0.85em;">
                                        <span style="white-space:nowrap"><span class="res-badge ${badgeClass}">${m.result}</span> <span style="color:var(--text-muted); margin-left:4px;">${m.date}</span></span>
                                        <span style="white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:65%; text-align:right;">vs ${m.opponent} <span style="color:var(--text-muted);">(${m.elo})</span> <b>${m.score}</b></span>
                                    </div>`;
                            });
                        }
                        h += '</div>';
                        return h;
                    };
                    return `<div class="history-container" style="margin-top:0;">
                                ${renderList(homeMatches, `${homeName} vs Opponents like ${awayName}`)}
                                ${renderList(awayMatches, `${awayName} vs Opponents like ${homeName}`)}
                            </div>`;
                };

                // --- Visualizer: Fetch and Render Charts ---
                const eloResponse = await fetch(`/elo-history?home=${encodeURIComponent(home)}&away=${encodeURIComponent(away)}`);
                const eloData = await eloResponse.json();

                const goalResponse = await fetch(`/goal-form?home=${encodeURIComponent(home)}&away=${encodeURIComponent(away)}`);
                const goalData = await goalResponse.json();

                // Wait for DOM update before rendering charts
                setTimeout(() => {
                    // Render ELO Chart
                    const eloCanvas = document.getElementById('eloChart');
                    if (eloCanvas) {
                        const eloCtx = eloCanvas.getContext('2d');
                        if (window.eloChartInstance) window.eloChartInstance.destroy();
                        window.eloChartInstance = new Chart(eloCtx, {
                            type: 'line',
                            data: {
                                labels: eloData.home.map(d => d.date),
                                datasets: [
                                    { label: home, data: eloData.home.map(d => d.elo), borderColor: '#3b82f6', tension: 0.4 },
                                    { label: away, data: eloData.away.map(d => d.elo), borderColor: '#ef4444', tension: 0.4 }
                                ]
                            },
                            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: '#94a3b8' } } }, scales: { y: { ticks: { color: '#94a3b8' }, grid: { color: '#334155' } }, x: { ticks: { color: '#94a3b8' }, grid: { display: false } } } }
                        });
                    }

                    // Render Goal Form Chart
                    const goalCanvas = document.getElementById('goalChart');
                    if (goalCanvas) {
                        const goalCtx = goalCanvas.getContext('2d');
                        if (window.goalChartInstance) window.goalChartInstance.destroy();
                        window.goalChartInstance = new Chart(goalCtx, {
                            type: 'bar',
                            data: {
                                labels: goalData.home.map(d => d.opponent),
                                datasets: [
                                    { label: `${home} Scored`, data: goalData.home.map(d => d.scored), backgroundColor: '#3b82f6' },
                                    { label: `${home} Conceded`, data: goalData.home.map(d => d.conceded), backgroundColor: '#1e293b', borderColor: '#3b82f6', borderWidth: 1 }
                                ]
                            },
                            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: '#94a3b8' } } }, scales: { y: { ticks: { color: '#94a3b8' }, grid: { color: '#334155' } }, x: { ticks: { color: '#94a3b8' }, grid: { display: false } } } }
                        });
                    }
                }, 100); // Small delay to ensure DOM is ready


            resultDiv.innerHTML = `
                <div class="animate-in">
                    ${rivalryHTML}
                    ${insightsHTML}
                    ${oracleHTML}
                    ${bestBetHTML}

                    <h2 style="text-align:center; margin-bottom:20px;">Match Outcome Probability</h2>
                    <div class="prob-grid">
                        <div class="prob-box">
                            <div style="font-size:1.1em; font-weight:bold;">üè† ${home}</div>
                            <div style="margin-top:5px;">${renderBadges(data.home_badges)}</div>
                            <strong style="display:block; margin-top:10px; font-size:1.8em;">${data.home_win}%</strong>
                        </div>
                        <div class="prob-box">
                            <div style="font-size:1.1em; font-weight:bold;">ü§ù Draw</div>
                            <strong style="display:block; margin-top:35px; font-size:1.8em; color:var(--text-muted);">${data.draw}%</strong>
                        </div>
                        <div class="prob-box">
                            <div style="font-size:1.1em; font-weight:bold;">‚úàÔ∏è ${away}</div>
                            <div style="margin-top:5px;">${renderBadges(data.away_badges)}</div>
                            <strong style="display:block; margin-top:10px; font-size:1.8em;">${data.away_win}%</strong>
                        </div>
                    </div>

                    <button class="collapsible" onclick="toggleCollapsible(this)">üìä Stats & Analysis</button>
                    <div class="content">
                            <div class="analysis" style="border:none; margin-top:0;">
                            <br>
                            <div class="comp-row"><div class="comp-val home">${data.features_used.home_form_score}</div><div class="comp-lbl">Recent Form</div><div class="comp-val away">${data.features_used.away_form_score}</div></div>
                            <div class="comp-row"><div class="comp-val home">${Math.round(data.features_used.home_elo)}</div><div class="comp-lbl">ELO Rating</div><div class="comp-val away">${Math.round(data.features_used.away_elo)}</div></div>
                            <div class="comp-row"><div class="comp-val home">${data.features_used.home_home_form}</div><div class="comp-lbl">Venue Form</div><div class="comp-val away">${data.features_used.away_away_form}</div></div>
                            <div class="comp-row"><div class="comp-val home">${data.features_used.home_goals_scored}</div><div class="comp-lbl">Avg Goals Scored</div><div class="comp-val away">${data.features_used.away_goals_scored}</div></div>
                            <div class="comp-row"><div class="comp-val home">${data.features_used.home_goals_conceded}</div><div class="comp-lbl">Avg Goals Conceded</div><div class="comp-val away">${data.features_used.away_goals_conceded}</div></div>
                            <div class="comp-row"><div class="comp-val home">${data.features_used.home_shots_ot}</div><div class="comp-lbl">Avg Shots on Target</div><div class="comp-val away">${data.features_used.away_shots_ot}</div></div>
                            <div class="comp-row"><div class="comp-val home">${data.features_used.home_corners}</div><div class="comp-lbl">Avg Corners</div><div class="comp-val away">${data.features_used.away_corners}</div></div>
                            <div class="comp-row"><div class="comp-val home">${data.features_used.home_cards}</div><div class="comp-lbl">Avg Cards</div><div class="comp-val away">${data.features_used.away_cards}</div></div>
                            <div class="comp-row"><div class="comp-val home">${data.features_used.home_rest_days}d</div><div class="comp-lbl">Rest Days</div><div class="comp-val away">${data.features_used.away_rest_days}d</div></div>
                        </div>
                    </div>

                    <button class="collapsible" onclick="toggleCollapsible(this)">üìà ELO History Chart</button>
                    <div class="content">
                        <div class="chart-container">
                            <canvas id="eloChart"></canvas>
                        </div>
                    </div>

                    <button class="collapsible" onclick="toggleCollapsible(this)">‚öΩ Goal Form Chart</button>
                    <div class="content">
                        <div class="chart-container">
                            <canvas id="goalChart"></canvas>
                        </div>
                    </div>

                    <button class="collapsible" onclick="toggleCollapsible(this)">ü§ø Deep Dive</button>
                    <div class="content">
                        ${renderDeepDive(data.home_deep_dive, home)}
                        <hr style="border: 0; border-top: 1px dashed var(--border); margin: 20px 0;">
                        ${renderDeepDive(data.away_deep_dive, away)}
                    </div>

                    <button class="collapsible" onclick="toggleCollapsible(this)">üìà Over/Under Markets</button>
                    <div class="content">${goalsHTML}</div>

                    <button class="collapsible" onclick="toggleCollapsible(this)">‚öîÔ∏è Head-to-Head</button>
                    <div class="content" style="padding-top:15px;">${data.h2h.length ? renderH2H(data.h2h) : '<div style="color:var(--text-muted); font-style:italic;">No recent history found.</div>'}</div>

                    <button class="collapsible" onclick="toggleCollapsible(this)">üîç Performance vs Similar Opponents</button>
                    <div class="content" style="padding-top:15px;">${renderSimilarSplit(data.home_similar, data.away_similar, home, away)}</div>

                    <button class="collapsible" onclick="toggleCollapsible(this)">üìÖ Recent History</button>
                    <div class="content" style="padding-top:15px;">
                        <div class="history-container">
                            <div class="history-box">
                                ${renderTeamStanding(data.home_standings, home, data.home_league_name)}
                                <h3 style="margin-top:20px; margin-bottom:10px;">${home} Last 5</h3>
                                ${renderHistory(data.home_history)}
                            </div>
                            <div class="history-box">
                                ${renderTeamStanding(data.away_standings, away, data.away_league_name)}
                                <h3 style="margin-top:20px; margin-bottom:10px;">${away} Last 5</h3>
                                ${renderHistory(data.away_history)}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            } catch (e) {
                resultDiv.innerHTML = `<div style="color:red">Connection Error: ${e}</div>`;
            }
        }

        async function scanMarket() {
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div style="text-align:center; padding:20px; color:var(--text-muted);">Scanning upcoming matches for value... (This may take a few seconds)</div>';

            try {
                const response = await fetch('/scan');
                const data = await response.json();

                if (data.message) {
                    resultDiv.innerHTML = `<h2>üîç Top Value Picks</h2><p style='color:var(--text-muted); font-style:italic;'>${data.message}</p>`;
                    return;
                }

                const picks = data.picks;
                const accaHTML = [
                    { acca: data.acca_super, title: "üëë SUPER Golden Ticket", color: "linear-gradient(135deg, #F59E0B 0%, #D97706 100%)" },
                    { acca: data.acca_o25, title: "üöÄ Over 2.5 Golden Ticket", color: "linear-gradient(135deg, #3B82F6 0%, #2563EB 100%)" },
                    { acca: data.acca_o15, title: "üî• Over 1.5 Golden Ticket", color: "linear-gradient(135deg, #EF4444 0%, #DC2626 100%)" }
                ].map(({ acca, title, color }) => {
                    if (acca && acca.legs.length > 1) {
                        let legsHTML = acca.legs.map(leg => `
                            <div style="display: flex; justify-content: space-between; border-bottom: 1px dashed rgba(255,255,255,0.2); padding: 10px 0;">
                                <span>${leg.match} <span style="font-size: 0.8em; font-weight: bold; opacity:0.8;">(${leg.market})</span></span>
                                <strong>${leg.fair_odds}</strong>
                            </div>
                        `).join('');

                        return `
                            <div style="background: ${color}; color: white; padding: 20px; border-radius: 16px; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); position: relative; overflow: hidden;">
                                <div style="position: absolute; top: -10px; right: -10px; font-size: 6em; opacity: 0.1;">${title.includes('SUPER') ? 'üëë' : 'üöÄ'}</div>
                                <h3 style="margin-top:0; border-bottom: 2px solid rgba(255,255,255,0.2); padding-bottom: 10px;">${title}</h3>
                                <div style="background: rgba(0,0,0,0.2); border-radius: 12px; padding: 15px; margin-bottom: 15px;">
                                    ${legsHTML}
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center; font-size: 1.2em;">
                                    <span>Combined Fair Odds:</span>
                                    <span style="font-size: 1.5em; font-weight: 800;">${acca.total_odds.toFixed(2)}</span>
                                </div>
                                <div style="text-align: right; font-size: 0.9em; margin-top: 5px; opacity:0.9;">$10 Bet Returns: <b>$${(acca.total_odds * 10).toFixed(2)}</b></div>
                            </div>
                        `;
                    }
                    return '';
                }).join('');

                let picksHTML = '<h2>üîç Top Value Picks</h2>';
                if (picks.length === 0) {
                    picksHTML += '<p style="color:var(--text-muted);">No high-confidence bets found for the next 7 days.</p>';
                } else {
                    picks.forEach(pick => {
                        let sentimentHTML = '';
                        if (pick.sentiment > 5) {
                            sentimentHTML = `<span class="steam-badge">üöÇ Steam</span>`;
                        } else if (pick.sentiment < -5) {
                            sentimentHTML = `<span class="steam-badge" style="color:var(--danger); border-color:var(--danger);">‚ö†Ô∏è Fade</span>`;
                        }

                        picksHTML += `<div style="background:rgba(255,255,255,0.03); padding:15px; border-radius:12px; border-left:4px solid var(--accent); margin-bottom:12px; border: 1px solid var(--border); border-left-width: 4px; text-align:left;">
                            <div style="font-size:0.85em; color:var(--text-muted); margin-bottom:5px;">${pick.date} ‚Ä¢ ${pick.league}</div>
                            <div style="font-weight:bold; font-size:1.1em; margin-bottom:8px;">${pick.match}</div>
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <span style="background:rgba(139, 92, 246, 0.15); color:var(--accent); padding:4px 10px; border-radius:6px; font-weight:bold; font-size:0.9em;">${pick.market}</span>
                                <span style="font-size:0.95em;">
                                    Prob: <b style="color:var(--success);">${pick.prob}%</b>
                                    <span style="color:var(--border); margin:0 5px;">|</span>
                                    Odds: <b>${pick.bookie_odds}</b>
                                    <span class="value-badge">Value: +${pick.value}%</span>
                                    <span class="kelly-badge">Kelly: ${pick.kelly_stake}%</span>
                                    ${sentimentHTML}
                                </span>
                            </div>
                        </div>`;
                    });
                }

                resultDiv.innerHTML = accaHTML + picksHTML;
            } catch (e) {
                resultDiv.innerHTML = `<div style="color:var(--danger)">Scan Error: ${e}</div>`;
            }
        }
    </script>
</body>
</html>